<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Lesson 3: IMU and Proprioception for Humanoid Robots | Physical AI &amp; Humanoid Robotics Textbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://anusbutt.github.io/hackathon-phase-01/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://anusbutt.github.io/hackathon-phase-01/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lesson 3: IMU and Proprioception for Humanoid Robots | Physical AI &amp; Humanoid Robotics Textbook"><meta data-rh="true" name="description" content="Learn how inertial measurement units and proprioceptive sensors enable humanoid robots to sense their own motion, orientation, and body position for dynamic balance control and spatial self-awareness."><meta data-rh="true" property="og:description" content="Learn how inertial measurement units and proprioceptive sensors enable humanoid robots to sense their own motion, orientation, and body position for dynamic balance control and spatial self-awareness."><meta data-rh="true" name="keywords" content="IMU,inertial measurement unit,proprioception,accelerometer,gyroscope,sensor fusion,ROS2,sensor_msgs/Imu"><link data-rh="true" rel="icon" href="/hackathon-phase-01/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception"><link data-rh="true" rel="alternate" href="https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception" hreflang="en"><link data-rh="true" rel="alternate" href="https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Physical AI & Humanoid Robotics","item":"https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/"},{"@type":"ListItem","position":2,"name":"Module 2: Sensors and Perception for Humanoid Robots","item":"https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/"},{"@type":"ListItem","position":3,"name":"IMU & Proprioception","item":"https://anusbutt.github.io/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception"}]}</script><link rel="alternate" type="application/rss+xml" href="/hackathon-phase-01/blog/rss.xml" title="Physical AI &amp; Humanoid Robotics Textbook RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/hackathon-phase-01/blog/atom.xml" title="Physical AI &amp; Humanoid Robotics Textbook Atom Feed"><link rel="stylesheet" href="/hackathon-phase-01/assets/css/styles.5903934b.css">
<script src="/hackathon-phase-01/assets/js/runtime~main.94161a1c.js" defer="defer"></script>
<script src="/hackathon-phase-01/assets/js/main.ab534ac3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/hackathon-phase-01/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hackathon-phase-01/"><div class="navbar__logo"><img src="/hackathon-phase-01/img/logo.svg" alt="Physical AI Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/hackathon-phase-01/img/logo.svg" alt="Physical AI Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Physical AI &amp; Humanoid Robotics Textbook</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/">Textbook</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/anusbutt/hackathon-phase-01" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/"><span title="Physical AI &amp; Humanoid Robotics" class="categoryLinkLabel_W154">Physical AI &amp; Humanoid Robotics</span></a><button aria-label="Collapse sidebar category &#x27;Physical AI &amp; Humanoid Robotics&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/ros2-nervous-system/"><span title="Module 1: The Robotic Nervous System (ROS 2)" class="categoryLinkLabel_W154">Module 1: The Robotic Nervous System (ROS 2)</span></a><button aria-label="Expand sidebar category &#x27;Module 1: The Robotic Nervous System (ROS 2)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/"><span title="Module 2: Sensors and Perception for Humanoid Robots" class="categoryLinkLabel_W154">Module 2: Sensors and Perception for Humanoid Robots</span></a><button aria-label="Collapse sidebar category &#x27;Module 2: Sensors and Perception for Humanoid Robots&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/camera-systems"><span title="Lesson 1: Camera Systems and Computer Vision" class="linkLabel_WmDU">Lesson 1: Camera Systems and Computer Vision</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/camera-systems.summary"><span title="Summary: Lesson 1 - Camera Systems and Computer Vision" class="linkLabel_WmDU">Summary: Lesson 1 - Camera Systems and Computer Vision</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/depth-sensing"><span title="Lesson 2: Depth Sensing Technologies" class="linkLabel_WmDU">Lesson 2: Depth Sensing Technologies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/depth-sensing.summary"><span title="Summary: Lesson 2 - Depth Sensing Technologies" class="linkLabel_WmDU">Summary: Lesson 2 - Depth Sensing Technologies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception"><span title="IMU &amp; Proprioception" class="linkLabel_WmDU">IMU &amp; Proprioception</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception.summary"><span title="Summary: Lesson 3 - IMU and Proprioception" class="linkLabel_WmDU">Summary: Lesson 3 - IMU and Proprioception</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/sensor-fusion"><span title="Sensor Fusion" class="linkLabel_WmDU">Sensor Fusion</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/sensor-fusion.summary"><span title="Lesson 4 Summary: Sensor Fusion Techniques for Humanoid Robots" class="linkLabel_WmDU">Lesson 4 Summary: Sensor Fusion Techniques for Humanoid Robots</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/capstone-project.architecture"><span title="Multi-Sensor Fusion Capstone: Architecture Documentation" class="linkLabel_WmDU">Multi-Sensor Fusion Capstone: Architecture Documentation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/capstone-project.casestudies"><span title="Case Studies: Real-World Multi-Sensor Integration" class="linkLabel_WmDU">Case Studies: Real-World Multi-Sensor Integration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/capstone-project.content"><span title="Module 2 Capstone Project: Integrated Sensor System Design" class="linkLabel_WmDU">Module 2 Capstone Project: Integrated Sensor System Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/capstone-project"><span title="Capstone Project: Design a Multi-Sensor Humanoid Perception System" class="linkLabel_WmDU">Capstone Project: Design a Multi-Sensor Humanoid Perception System</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/capstone-project.summary"><span title="Capstone Summary" class="linkLabel_WmDU">Capstone Summary</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/quiz"><span title="Module 2 Quiz: Sensors and Perception for Humanoid Robots" class="linkLabel_WmDU">Module 2 Quiz: Sensors and Perception for Humanoid Robots</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/isaac-ai-brain/"><span title="Module 3: The AI-Robot Brain (NVIDIA Isaacâ„¢)" class="categoryLinkLabel_W154">Module 3: The AI-Robot Brain (NVIDIA Isaacâ„¢)</span></a><button aria-label="Expand sidebar category &#x27;Module 3: The AI-Robot Brain (NVIDIA Isaacâ„¢)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/vision-language-action/"><span title="Module 4: Vision-Language-Action (VLA)" class="categoryLinkLabel_W154">Module 4: Vision-Language-Action (VLA)</span></a><button aria-label="Expand sidebar category &#x27;Module 4: Vision-Language-Action (VLA)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hackathon-phase-01/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/"><span>Physical AI &amp; Humanoid Robotics</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/"><span>Module 2: Sensors and Perception for Humanoid Robots</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">IMU &amp; Proprioception</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Lesson 3: IMU and Proprioception for Humanoid Robots</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-an-imu">What Is an IMU?<a href="#what-is-an-imu" class="hash-link" aria-label="Direct link to What Is an IMU?" title="Direct link to What Is an IMU?" translate="no">â€‹</a></h2>
<p>An IMU (Inertial Measurement Unit) is a sensor that measures motion and orientation without relying on external reference points like GPS satellites or visual landmarks. It detects acceleration, rotation rates, and magnetic field direction, giving robots an &quot;internal sense&quot; of movement that works anywhere - underground, indoors, outdoors, even in complete darkness.</p>
<p>An IMU combines three distinct types of sensors working together. The <strong>accelerometer</strong> measures linear acceleration (including gravity) in meters per second squared (m/sÂ²), allowing the robot to detect how fast it&#x27;s speeding up, slowing down, or tilting. The <strong>gyroscope</strong> detects angular velocity - the rate of rotation - in radians per second (rad/s), tracking how quickly the robot is turning around any axis. The <strong>magnetometer</strong> senses Earth&#x27;s magnetic field to establish heading or compass direction, much like a traditional compass but in digital form. Together, these three sensors create a complete picture of the robot&#x27;s motion and orientation without needing to &quot;see&quot; anything.</p>
<p>The term &quot;inertial&quot; comes from the physics principle of inertia - how objects resist changes in motion. Because IMU measurements are based on detecting changes in motion rather than observing external landmarks, they work in environments where cameras and depth sensors fail. You can navigate with an IMU in a tunnel with no GPS signal, in fog where cameras can&#x27;t see, or in darkness where visual sensors are useless.</p>
<p>For humanoid robots, IMUs are absolutely critical. A humanoid robot must balance on two feet like a human, which is inherently unstable - imagine standing on stilts while someone pushes you. The IMU provides constant, real-time feedback about the robot&#x27;s body orientation and motion, enabling bipedal locomotion, dynamic stability, and recovery from disturbances. Without an IMU, the robot simply cannot know if it&#x27;s tilting forward, backward, or sideways until it&#x27;s already falling. By the time a camera detects the ground rushing up, it&#x27;s too late to react. The IMU is the robot&#x27;s inner ear - the sense that keeps it upright.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-imu-matters-for-physical-ai">Why IMU Matters for Physical AI<a href="#why-imu-matters-for-physical-ai" class="hash-link" aria-label="Direct link to Why IMU Matters for Physical AI" title="Direct link to Why IMU Matters for Physical AI" translate="no">â€‹</a></h2>
<p>Humanoid robots stand on two feet, making them inherently unstable in the same way humans are. Unlike wheeled robots with their stable four-point contact, bipedal robots are constantly on the edge of falling. Without IMU feedback, the robot is effectively &quot;blind&quot; to its own tilt, rotation, and acceleration. Camera-only perception introduces processing lag - by the time the visual system detects a problem, the robot may already be falling. When a humanoid starts to tip, it must react in milliseconds, far too fast for visual processing alone. This is where the IMU becomes indispensable.</p>
<p><strong>Self-Awareness and Proprioception</strong>: An IMU gives the robot knowledge of its own orientation even in total darkness or thick fog. Combined with joint encoders that report the angle of each limb, the robot knows exactly where its body is positioned in three-dimensional space. This is analogous to human proprioception - you know where your arm is even with your eyes closed. This internal body awareness is foundational for manipulation tasks (reaching for objects while maintaining balance), posture control (adjusting stance on uneven surfaces), and graceful falling (detecting an unrecoverable tip and positioning limbs to minimize damage).</p>
<p><strong>Dynamic Balance and Fall Prevention</strong>: The IMU detects tilt before it becomes a catastrophic fall. By monitoring orientation changes in real time, the robot can execute corrective movements through a control loop that operates in 25-50 milliseconds from disturbance detection to motor actuation, with complete corrective movements executing within 50-200 milliseconds - faster than human reaction time of approximately 200 milliseconds. This allows the implementation of balance strategies like ankle adjustments (rotating feet to shift center of pressure), hip movements (bending at the waist to counterbalance), or taking a recovery step. The difference between a robot that stumbles awkwardly and one that recovers gracefully comes down to fast, accurate IMU feedback. In real-world scenarios - a robot operating on a construction site, navigating a crowded sidewalk, or responding to an unexpected push - this capability is essential for safety and reliability.</p>
<p><strong>Motion Estimation and Localization</strong>: When visual sensors fail or become unreliable, the IMU provides continuous motion feedback. In GPS-denied environments like underground facilities, indoor warehouses, or tunnels, the IMU can track body motion between visual landmarks. It complements camera-based localization by filling the gaps when lighting conditions are poor, the environment is textureless (like a blank white hallway), or the robot is moving too fast for visual processing. While cameras tell the robot where it is relative to the world, the IMU tells it how it&#x27;s moving right now.</p>
<p>Scaling this to humanoid tasks reveals the full importance. Picking up objects requires balance awareness while reaching - you lean forward to grab something, the IMU detects the shift in center of mass, and the balance controller adjusts your stance to prevent tipping. Walking on uneven surfaces demands constant IMU feedback to drive foot placement decisions - detect the tilt from stepping on a rock, adjust the next step accordingly. Human-robot interaction scenarios involve reacting to external pushes or pulls, which the IMU detects instantly. Future humanoid robots performing sports-like activities - jumping, running, catching - will rely heavily on high-frequency IMU data to coordinate dynamic movements. The IMU is the foundation for robots doing real human tasks in human spaces.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-principles">Key Principles<a href="#key-principles" class="hash-link" aria-label="Direct link to Key Principles" title="Direct link to Key Principles" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="principle-1-imu-sensor-components-and-what-they-measure">Principle 1: IMU Sensor Components and What They Measure<a href="#principle-1-imu-sensor-components-and-what-they-measure" class="hash-link" aria-label="Direct link to Principle 1: IMU Sensor Components and What They Measure" title="Direct link to Principle 1: IMU Sensor Components and What They Measure" translate="no">â€‹</a></h3>
<p>Each of the three sensors in an IMU measures a different aspect of motion, and understanding what each one provides is key to interpreting IMU data correctly.</p>
<p>The <strong>accelerometer</strong> measures linear acceleration in three axes (X, Y, Z). Its units are meters per second squared (m/sÂ²). Critically, it always measures gravity - when the robot is sitting perfectly still on a table, the accelerometer reads approximately 9.81 m/sÂ² pointing upward (counteracting Earth&#x27;s downward gravitational pull). This makes it excellent for detecting tilt: if the robot leans forward, the direction of the gravity vector changes relative to the robot&#x27;s body frame. Accelerometers have high noise in their readings due to vibrations and sensor imperfections, but they provide a reliable long-term reference because gravity is constant. They&#x27;re used for tilt detection, fall detection (sudden acceleration spikes), and tracking linear motion.</p>
<p>The <strong>gyroscope</strong> measures angular velocity - how fast the robot is rotating around each of its three axes. Units are radians per second (rad/s) or degrees per second (deg/s). For example, turning your head left produces angular velocity around the vertical axis; tilting your head forward produces angular velocity around the horizontal axis. Gyroscopes are very accurate for short time periods (seconds to minutes) with low noise, making them ideal for detecting rapid rotation. However, they suffer from <strong>drift</strong> - small measurement errors accumulate over time. A gyroscope with a drift rate of 1 degree per second will be off by 3600 degrees after one hour of operation. This means gyroscopes are excellent for fast orientation changes but need constant recalibration from other sensors for long-term accuracy.</p>
<p>The <strong>magnetometer</strong> measures the strength and direction of Earth&#x27;s magnetic field in three axes. Units are microteslas (Î¼T). Unlike the gyroscope, which measures changes in orientation, the magnetometer provides an absolute heading reference - it always knows which direction is magnetic north. This makes it invaluable for correcting gyroscope drift over long periods. However, magnetometers are highly sensitive to interference from electronics, metal objects, and power lines, making them unreliable indoors or near machinery. They also typically have slower update rates compared to accelerometers and gyroscopes.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="principle-2-sensor-drift-and-noise-characteristics">Principle 2: Sensor Drift and Noise Characteristics<a href="#principle-2-sensor-drift-and-noise-characteristics" class="hash-link" aria-label="Direct link to Principle 2: Sensor Drift and Noise Characteristics" title="Direct link to Principle 2: Sensor Drift and Noise Characteristics" translate="no">â€‹</a></h3>
<p>No sensor is perfect. Each component of the IMU has distinct error characteristics that influence how we use it.</p>
<p>Accelerometers have the advantage of being reliable over long time periods. Because they measure gravity, which never changes, they provide a consistent reference for &quot;down&quot; that doesn&#x27;t drift over hours or days. However, they are noisy - vibrations from motors, footsteps, or even wind can add high-frequency noise to the readings. They also have bias errors, systematic offsets from the true value, though these can often be calibrated out during initialization. The use case for accelerometers is detecting tilt with high accuracy over extended periods, making them the foundation for long-term orientation estimation.</p>
<p>Gyroscopes are highly accurate in the short term with very low noise, making them perfect for tracking fast rotational movements. But their fatal flaw is drift. Consumer-grade MEMS gyroscopes typically have drift rates of 0.1 to 1 degree per hour, while tactical-grade IMUs used in humanoid robots achieve 1-3 degrees per hour, and navigation-grade systems can reach below 0.01 degrees per hour. Even at these rates, drift accumulates - a 1 degree per hour drift means the orientation estimate will be off by 24 degrees after one day of operation. This is why gyroscopes must be continuously corrected using other sensors. Their use case is measuring fast orientation changes over timescales from milliseconds to hours, after which they need recalibration.</p>
<p>Magnetometers provide an absolute heading reference, which is their key strength. No matter how much the robot spins, the magnetometer can tell you which direction is magnetic north. However, they&#x27;re plagued by magnetic interference. A nearby motor, a steel beam, or even the robot&#x27;s own electronics can distort the readings. Indoors, magnetometers are often unreliable. They also have slower update rates than accelerometers and gyroscopes, making them unsuitable for fast control loops.</p>
<p>The key insight is that no single sensor is perfect. Accelerometers drift less but are noisy. Gyroscopes are precise but drift quickly. Magnetometers provide absolute reference but are interference-prone. This is why sensor fusion - intelligently combining all three - is essential for robust orientation estimation, which we&#x27;ll explore in the next lesson.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="principle-3-sensor_msgsimu-message-structure-and-ros2-integration">Principle 3: sensor_msgs/Imu Message Structure and ROS2 Integration<a href="#principle-3-sensor_msgsimu-message-structure-and-ros2-integration" class="hash-link" aria-label="Direct link to Principle 3: sensor_msgs/Imu Message Structure and ROS2 Integration" title="Direct link to Principle 3: sensor_msgs/Imu Message Structure and ROS2 Integration" translate="no">â€‹</a></h3>
<p>In ROS2, IMU data flows through the system using the standard <code>sensor_msgs/Imu</code> message type. Understanding its structure is critical for working with IMU data in your robot code.</p>
<p>The message contains six main fields. The <strong>header</strong> includes a timestamp (when the measurement was taken) and a frame_id (which robot link the IMU is physically attached to, like &quot;base_link&quot; or &quot;imu_link&quot;). This allows the system to transform IMU data into other coordinate frames if needed. The <strong>orientation</strong> field is a quaternion - a four-value representation of 3D rotation as [x, y, z, w]. Quaternions are used instead of Euler angles (roll, pitch, yaw) because they avoid gimbal lock, a mathematical singularity that occurs at certain orientations. For example, a quaternion of [0, 0, 0.707, 0.707] represents a 90-degree rotation around the Z-axis. While quaternions are compact and mathematically robust, they&#x27;re not intuitive, so they&#x27;re often converted to Euler angles for human interpretation or simple control logic.</p>
<p>The <strong>angular_velocity</strong> field is a Vector3 containing the rotation rate around the X, Y, and Z axes in radians per second. This comes directly from the gyroscope. The <strong>linear_acceleration</strong> field is another Vector3 with acceleration along the X, Y, and Z axes in meters per second squared, coming from the accelerometer. Remember that this includes gravity - a stationary robot will show [0, 0, 9.81] if Z points upward.</p>
<p>The message also includes <strong>covariance matrices</strong> - 9-element arrays (representing 3x3 matrices in row-major order) for orientation, angular velocity, and linear acceleration. These covariance values encode the uncertainty or confidence in each measurement. High covariance means low confidence; low covariance means high confidence. Sensor fusion algorithms use these values to weight how much to trust each sensor at any given moment.</p>
<p>In practice, the flow works like this: The physical IMU sensor captures raw data, which the ROS2 driver packages into a <code>sensor_msgs/Imu</code> message and publishes to a topic (commonly <code>/imu/data</code>). Your robot&#x27;s control software subscribes to this topic and receives updates at 100-500 Hz depending on the hardware. From this data, you can compute tilt angles from the orientation quaternion, detect falling by monitoring acceleration spikes, or track rotation by integrating angular velocity.</p>
<p>For example, a stationary robot on level ground will show <code>linear_acceleration = [0, 0, 9.81]</code> (only gravity), <code>angular_velocity = [0, 0, 0]</code> (not rotating), and an orientation quaternion close to [0, 0, 0, 1] (no rotation from the initial pose). If the robot starts tilting forward, the acceleration vector rotates - the Z component decreases while the X component (forward direction) increases. If the robot spins, the angular_velocity around the Z-axis becomes non-zero.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="principle-4-proprioception---robots-sense-of-body-position-and-motion">Principle 4: Proprioception - Robot&#x27;s Sense of Body Position and Motion<a href="#principle-4-proprioception---robots-sense-of-body-position-and-motion" class="hash-link" aria-label="Direct link to Principle 4: Proprioception - Robot&#x27;s Sense of Body Position and Motion" title="Direct link to Principle 4: Proprioception - Robot&#x27;s Sense of Body Position and Motion" translate="no">â€‹</a></h3>
<p>Proprioception is the sense of knowing where your body is and how it&#x27;s moving without looking at it. Close your eyes and raise your arm above your head - you know exactly where your arm is. That&#x27;s proprioception, enabled by nerve endings in your muscles and joints. Robots need the same capability.</p>
<p>In robotics, proprioception is the ability to sense the robot&#x27;s own body position and motion without external observation. While humans use biological sensors embedded in tissues, robots achieve proprioception through a combination of hardware sensors. IMU data provides the orientation and acceleration of the robot&#x27;s torso or base. Joint encoders report the angle at each articulated joint - shoulder, elbow, hip, knee, ankle. Together, these sensors create a complete real-time picture of the robot&#x27;s body state in three dimensions.</p>
<p>This internal body awareness is critical for humanoid robots in ways that wheeled robots don&#x27;t experience. During walking, the robot needs to know foot placement relative to its center of mass to maintain balance. While reaching for an object, it must know arm position relative to its moving torso. When reacting to an external push, the robot needs instantaneous feedback about body tilt to adjust muscles and prevent falling. Unlike wheeled robots, which have stable bases and relatively simple kinematics, humanoid bipeds are constantly adjusting for stability, making proprioception a moment-to-moment necessity.</p>
<p>The distinction between proprioception and vision is important. Vision provides external perception - information about the world around the robot. It can fail in darkness, fog, or when the camera is occluded. It also operates at relatively low frequencies (typically 30 Hz for cameras) with processing delays. Proprioception, by contrast, is internal perception - information about the robot&#x27;s own body. It&#x27;s always available regardless of lighting or environmental conditions, and it operates at high frequencies (100+ Hz for IMUs, 1000+ Hz for joint encoders) with minimal latency. Both are needed: vision for navigation and understanding the environment, proprioception for balance and body control.</p>
<p>For computer science students, a useful analogy is how a programming language maintains internal state. Your program knows the values of its variables without needing to query an external database. Similarly, the robot maintains state of its own body through proprioceptive sensors - it knows where it is without needing to &quot;look at itself&quot; through cameras.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="principle-5-balance-control-loop---feedback-and-correction">Principle 5: Balance Control Loop - Feedback and Correction<a href="#principle-5-balance-control-loop---feedback-and-correction" class="hash-link" aria-label="Direct link to Principle 5: Balance Control Loop - Feedback and Correction" title="Direct link to Principle 5: Balance Control Loop - Feedback and Correction" translate="no">â€‹</a></h3>
<p>Balance for a humanoid robot is not a passive state - it&#x27;s an active control loop running continuously at high speed. The IMU is the sensor that makes this loop possible.</p>
<p>The closed-loop balance system has four stages that repeat constantly. First, <strong>sense</strong>: The IMU detects the current tilt angle (using the accelerometer&#x27;s gravity reference) and rotation rate (from the gyroscope). Second, <strong>compute</strong>: The balance controller analyzes the tilt and rate of change to determine what corrective action is needed. Third, <strong>act</strong>: The robot executes the corrective strategy by adjusting motor commands to ankle, hip, or leg joints. Fourth, the loop repeats, typically every 10-50 milliseconds.</p>
<p>Roboticists use three primary balance strategies, escalating in complexity based on the severity of the disturbance. The <strong>ankle strategy</strong> handles small disturbances, typically with tilt less than approximately 5 degrees (exact thresholds vary by robot design and perturbation speed). The robot rotates its ankles to move the center of pressure (where force is applied to the ground) under the center of mass (where gravity acts on the body). This is the fastest and most energy-efficient strategy. For example, if the IMU detects a 2-degree forward tilt, the controller commands the ankles to rotate backward slightly, bringing the robot back to vertical.</p>
<p>The <strong>hip strategy</strong> activates for moderate disturbances with tilt between 5 and 15 degrees. The robot bends at the hips while keeping the ankles relatively fixed, using larger body movements to shift the center of mass. This is more powerful than ankle adjustments but takes slightly longer and consumes more energy. If the IMU detects an 8-degree tilt that exceeds ankle strategy limits, the robot bends forward at the hips to counterbalance.</p>
<p>The <strong>stepping strategy</strong> is the last resort for large disturbances exceeding 15 degrees. The robot takes a step to place a foot under the new projected center of mass, effectively catching itself before falling. This is the most complex strategy, requiring coordination of swing leg trajectory, balance transfer, and landing control. If the IMU predicts based on tilt angle and angular velocity that the robot will fall, it initiates a recovery step.</p>
<p>The timing of this feedback loop is critical. A typical IMU updates at 200 Hz, meaning new data arrives every 5 milliseconds. The controller processes this data and computes a response in another 5-20 milliseconds. Motor commands are sent and begin executing within milliseconds. The total reaction time from disturbance detection to corrective action is 25-50 milliseconds. This is actually faster than human reaction time, which is around 200 milliseconds. The speed of the loop is what allows robots to maintain balance on two feet - without it, they&#x27;d topple before they could react.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-ai-colearning-prompt">ðŸ’¬ AI Colearning Prompt<a href="#-ai-colearning-prompt" class="hash-link" aria-label="Direct link to ðŸ’¬ AI Colearning Prompt" title="Direct link to ðŸ’¬ AI Colearning Prompt" translate="no">â€‹</a></h3>
<blockquote>
<p><strong>Sensor Fusion Challenge</strong>: Ask Claude to explain how you would combine accelerometer, gyroscope, and magnetometer readings to get a reliable orientation estimate that doesn&#x27;t drift over time. What information does each sensor provide that others don&#x27;t? Where might conflicts arise between sensor readings, and how would you resolve them?</p>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-expert-insight-imu-initialization-calibration-and-why-your-robot-falls-over">ðŸŽ“ Expert Insight: IMU Initialization, Calibration, and Why Your Robot Falls Over<a href="#-expert-insight-imu-initialization-calibration-and-why-your-robot-falls-over" class="hash-link" aria-label="Direct link to ðŸŽ“ Expert Insight: IMU Initialization, Calibration, and Why Your Robot Falls Over" title="Direct link to ðŸŽ“ Expert Insight: IMU Initialization, Calibration, and Why Your Robot Falls Over" translate="no">â€‹</a></h3>
<p>Many students assume that an IMU provides perfect orientation data the moment you power it on. The reality is quite different, and understanding this gap can save you hours of debugging when your robot unexpectedly falls over.</p>
<p>IMUs require a calibration and initialization phase before they can provide reliable data. The gyroscope, in particular, suffers from a systematic offset called bias - even when perfectly stationary, it reports a small non-zero angular velocity. This bias must be measured at startup while the robot is completely still. If you skip this step, your orientation estimate will be wrong from the very first reading, accumulating error immediately. Magnetometers also need calibration to account for local magnetic distortions. The calibration process typically involves keeping the robot stationary for 2-5 seconds to measure gyroscope bias, then slowly rotating the robot through its full range of motion to map magnetometer readings to known orientations. Higher-end IMU chips often have built-in self-calibration routines, but cheaper sensors require manual calibration in your initialization code. The impact of skipping this step is dramatic - the difference between stable walking and immediate falling.</p>
<p>That covariance matrix in the <code>sensor_msgs/Imu</code> message is not just metadata you can ignore. It tells your sensor fusion algorithm how much to trust each reading at this exact moment. A good IMU under normal conditions reports low covariance, indicating high confidence in the measurements. A faulty IMU, or one experiencing interference or vibration, will report high covariance. Production robotic systems monitor this covariance continuously. If it suddenly spikes, the system knows something is wrong - maybe the IMU is malfunctioning, maybe there&#x27;s unexpected magnetic interference - and it can switch to backup sensors or enter a safe mode rather than trusting bad data and falling.</p>
<p>This is precisely why sensor fusion exists, which we&#x27;ll cover in the next lesson. No single sensor is reliable enough for critical balance control. By combining three or more sensors and monitoring their covariance matrices, you create a robust system that tolerates individual sensor faults. The IMU is foundational, but it&#x27;s just one piece of the perception puzzle.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-examples">Real-World Examples<a href="#real-world-examples" class="hash-link" aria-label="Direct link to Real-World Examples" title="Direct link to Real-World Examples" translate="no">â€‹</a></h2>
<p>Understanding IMU specifications and applications in theory is valuable, but examining how leading robotics companies implement these sensors in production humanoid robots provides crucial practical insights. The following case studies demonstrate different IMU configurations, sensor fusion strategies, and integration approaches that enable balance, proprioception, and dynamic motion control in real-world humanoid platforms.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-boston-dynamics-atlas">ðŸ“Š Boston Dynamics Atlas<a href="#-boston-dynamics-atlas" class="hash-link" aria-label="Direct link to ðŸ“Š Boston Dynamics Atlas" title="Direct link to ðŸ“Š Boston Dynamics Atlas" translate="no">â€‹</a></h3>
<p>Boston Dynamics&#x27; Atlas represents the pinnacle of humanoid robotics, utilizing a sophisticated IMU system for balance and dynamic control. The robot employs a <strong>KVH 1750 tactical-grade IMU</strong> composed of Fiber Optic Gyroscopes (FOG) combined with MEMS accelerometers. This IMU is strategically positioned in the robot&#x27;s pelvis, located 9 cm behind the pelvis link and rotated 45Â° for optimal measurement orientation.</p>
<p>The KVH 1750 IMU features programmable data output rates from <strong>1-1000 Hz</strong> and is available with <strong>2g, 10g, or 30g accelerometer ranges</strong>, with Atlas likely using higher ranges to handle dynamic movements like parkour and backflips. The fiber optic gyroscopes provide superior angular momentum measurements compared to MEMS-only solutions, crucial for Atlas&#x27;s acrobatic capabilities.</p>
<p><strong>Key Technical Insight</strong>: Atlas&#x27;s choice of FOG-based IMU over pure MEMS reflects a design priority for precision over cost. The pelvis placement centralizes inertial measurements at the robot&#x27;s center of mass, while sensor fusion with force sensors, LiDAR, stereo vision, and joint encoders enables the Extended Kalman Filter (EKF) algorithms that maintain balance stability above 95% even during high-impact landings.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-agility-robotics-digit">ðŸ“Š Agility Robotics Digit<a href="#-agility-robotics-digit" class="hash-link" aria-label="Direct link to ðŸ“Š Agility Robotics Digit" title="Direct link to ðŸ“Š Agility Robotics Digit" translate="no">â€‹</a></h3>
<p>Digit, designed for warehouse logistics and bipedal manipulation tasks, uses a <strong>MEMS IMU</strong> integrated with a comprehensive sensor suite including four Intel RealSense depth cameras, LiDAR, force sensors in the arms, and both absolute and incremental encoders. The robot stands 5&#x27;9&quot; (175 cm) tall with 28 degrees of freedom and operates for 4 hours on battery power.</p>
<p>Digit&#x27;s IMU operates at typical MEMS sampling rates (<strong>100-200 Hz for accelerometers, 200-500 Hz for gyroscopes</strong>) with estimated ranges of <strong>Â±4g accelerometer</strong> and <strong>Â±500Â°/s gyroscope</strong> based on industry standards for bipedal robots. The torso-mounted IMU feeds real-time inertial data into sophisticated whole-body control hierarchies that compute Zero Moment Point (ZMP) and Center of Pressure (CoP) calculations for locomotion stability.</p>
<p><strong>Key Technical Insight</strong>: Digit&#x27;s sensor fusion approach demonstrates how combining IMU data with force sensor feedback and geometric models through EKF algorithms creates robust balance control. The integration of IMU with depth cameras and encoders significantly improves overall pose estimation accuracy compared to encoder-only approaches. The robot was trained across billions of simulation steps to enhance stability management when encountering physical disturbances, demonstrating how IMU data quality directly impacts machine learning model performance.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-unitree-h1">ðŸ“Š Unitree H1<a href="#-unitree-h1" class="hash-link" aria-label="Direct link to ðŸ“Š Unitree H1" title="Direct link to ðŸ“Š Unitree H1" translate="no">â€‹</a></h3>
<p>The Unitree H1 holds the Guinness World Record for the fastest full-sized humanoid robot at <strong>3.3 m/s</strong> and was the first electric humanoid to successfully land a standing backflipâ€”achievements made possible by advanced IMU-based balance control. The H1 combines <strong>real-time IMU sensors</strong> with 3D LiDAR (Livox Mid-360), Intel RealSense D435 depth cameras, joint encoders, and contact sensors in a comprehensive sensor fusion architecture.</p>
<p>At 180 cm tall and 47 kg, the H1 utilizes high-torque actuators (up to <strong>360 Nm joint torque</strong>) controlled by real-time sensor fusion algorithms that process IMU data for dynamic balance recovery. The IMU enables the robot to adapt to rough terrains, recover from external pushes, and maintain stability at high speedsâ€”critical for both the record-breaking running speed and backflip maneuvers.</p>
<p><strong>Key Technical Insight</strong>: H1&#x27;s success demonstrates the importance of <strong>response time</strong> in IMU-based balance systems. The sensor fusion loop processes IMU, encoder, and contact data with response times under 10 milliseconds, enabling the rapid corrective joint torques necessary for dynamic stability. The choice to integrate IMU data with 360Â° depth sensing through LiDAR creates a proprioceptive-exteroceptive feedback loop: IMU measures internal body state while LiDAR maps terrain, allowing predictive balance adjustments before ground contactâ€”essential for high-speed locomotion on uneven surfaces.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-example-balance-state-monitoring">Practical Example: Balance State Monitoring<a href="#practical-example-balance-state-monitoring" class="hash-link" aria-label="Direct link to Practical Example: Balance State Monitoring" title="Direct link to Practical Example: Balance State Monitoring" translate="no">â€‹</a></h2>
<p>Imagine you&#x27;re integrating balance control onto a humanoid robot. The IMU publishes orientation and acceleration data at 200 Hz. Your task is to monitor this stream and detect when the robot enters an unstable state. Specifically, you need to:</p>
<ol>
<li class="">Subscribe to the IMU topic using the <code>sensor_msgs/Imu</code> message type</li>
<li class="">Extract the tilt angle (roll and pitch) from the quaternion orientation</li>
<li class="">Check if tilt exceeds 10 degrees - if so, log a &quot;balance correction needed&quot; warning</li>
<li class="">Track acceleration to detect potential falls</li>
</ol>
<p>This represents the first stage of a balance control system: sensing and identifying unstable states before they become unrecoverable falls.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">IMU subscriber demonstrating balance state monitoring for humanoid robots.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">This node detects when the robot tilts beyond safe thresholds.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">node </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sensor_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Imu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> math</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">BalanceMonitor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Monitors IMU data and detects balance instability.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;balance_monitor&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Subscribe to IMU data from the robot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_subscription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Imu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;/imu/data&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imu_callback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tilt_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># degrees - ankle strategy limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">imu_callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Imu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Process incoming IMU data and check stability.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Extract quaternion (orientation)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orientation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orientation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orientation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orientation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Convert quaternion to roll/pitch angles using trigonometric formulas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        roll </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">atan2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2.0</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pitch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">asin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2.0</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> z</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Convert radians to degrees for human-readable output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        roll_deg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">degrees</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">roll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pitch_deg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">degrees</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pitch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Check if tilt exceeds threshold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">abs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">roll_deg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tilt_threshold </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token builtin">abs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pitch_deg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tilt_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Imbalance detected! Roll: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">roll_deg</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.1f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">Â°, Pitch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">pitch_deg</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.1f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">Â°&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Note: Full node lifecycle (rclpy.init, spin, shutdown) omitted for clarity</span><br></span></code></pre></div></div>
<p>The <code>BalanceMonitor</code> node subscribes to the <code>/imu/data</code> topic, which publishes <code>sensor_msgs/Imu</code> messages at high frequency (typically 200 Hz). In the callback function, we extract the quaternion - a compact four-value representation of 3D rotation that avoids mathematical singularities. We then convert this quaternion to roll and pitch angles using trigonometric formulas. Roll represents rotation around the forward-back axis (leaning left or right), while pitch represents rotation around the left-right axis (leaning forward or backward).</p>
<p>We compare these angles against a 10-degree threshold, which represents the practical limit for the ankle strategy we discussed earlier. If the robot tilts more than 10 degrees, ankle adjustments alone won&#x27;t be sufficient - the system needs to escalate to hip strategy or stepping strategy. The logger warning simulates sending a signal to the lower-level balance controller to take corrective action. In a complete system, this warning would trigger the appropriate balance strategy based on the severity and rate of tilt.</p>
<p>This example demonstrates the sensing-to-decision pipeline that underlies all robotic control: IMU hardware measures orientation â†’ ROS2 middleware delivers the data as messages â†’ callback function processes the data â†’ control decisions are made based on thresholds and logic. Real production systems add filtering to remove noise, sensor fusion to combine IMU with other sensors, and sophisticated control algorithms that consider velocity and acceleration trends, but this captures the essential pattern. You&#x27;re seeing Principles 3 and 5 in action: interpreting the <code>sensor_msgs/Imu</code> structure and closing the balance control feedback loop.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-example-fall-detection-algorithm">Practical Example: Fall Detection Algorithm<a href="#practical-example-fall-detection-algorithm" class="hash-link" aria-label="Direct link to Practical Example: Fall Detection Algorithm" title="Direct link to Practical Example: Fall Detection Algorithm" translate="no">â€‹</a></h2>
<p>Building on the balance monitoring concepts, let&#x27;s examine a more sophisticated application: detecting when a humanoid robot is experiencing a fall event. Falls have two characteristic phases that IMU sensors can detect: <strong>freefall</strong> (when the robot loses contact with the ground and experiences near-zero acceleration) and <strong>impact</strong> (when the robot hits the ground with a sudden acceleration spike). Detecting these events allows the robot to trigger protective responses like activating compliance control, stopping dangerous motions, or alerting human operators.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Example 2: Fall Detection Algorithm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Fall Detection Node using IMU Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">This node implements a fall detection algorithm for humanoid robots by monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">IMU acceleration data. It detects two phases of a fall:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">1. Freefall: Low acceleration magnitude (robot is falling freely)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">2. Impact: High acceleration spike (robot hits the ground)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">This is crucial for humanoid robots to detect falls and trigger protective responses</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">like activating compliance control or stopping dangerous motions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Author: ROS2 Nervous System Tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">License: MIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">node </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sensor_msgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">msg </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Imu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FallDetector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    A ROS2 node that detects potential falls using IMU acceleration data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    The algorithm uses acceleration magnitude thresholds to identify freefall</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    and impact events, which are the characteristic phases of a fall.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Initialize the fall detection node with threshold parameters.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;fall_detector&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Fall detection thresholds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FREEFALL_THRESHOLD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># m/sÂ² - below this indicates freefall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IMPACT_THRESHOLD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20.0</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># m/sÂ² - above this indicates impact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FREEFALL_DURATION</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># seconds - minimum freefall time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># State tracking variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_acceleration_magnitude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9.81</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Start with gravity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">in_freefall</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freefall_start_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Time</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fall_detected</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Create subscription to IMU data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_subscription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Imu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;/imu/data&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imu_callback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscription  </span><span class="token comment" style="color:#999988;font-style:italic"># Prevent unused variable warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Fall Detector initialized.\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Freefall threshold: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">FREEFALL_THRESHOLD</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> m/sÂ²\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Impact threshold: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">IMPACT_THRESHOLD</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> m/sÂ²\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Minimum freefall duration: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">FREEFALL_DURATION</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculate_acceleration_magnitude</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Imu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Calculate the total acceleration magnitude from IMU data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        The magnitude is computed as: sqrt(axÂ² + ayÂ² + azÂ²)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        During normal standing, this should be approximately 9.81 m/sÂ² (gravity).</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            msg: The IMU message containing acceleration data</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            The acceleration magnitude in m/sÂ²</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            accel_vector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear_acceleration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear_acceleration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear_acceleration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Calculate Euclidean norm (magnitude)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            magnitude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">accel_vector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> magnitude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Error calculating acceleration magnitude: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9.81</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Return gravity as default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check_freefall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> magnitude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Check if the robot is in freefall based on acceleration magnitude.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Freefall is characterized by very low acceleration (near zero) because</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        the sensor experiences weightlessness when falling freely.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            magnitude: Current acceleration magnitude in m/sÂ²</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            current_time: Current ROS2 timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> magnitude </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FREEFALL_THRESHOLD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">in_freefall</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Start of freefall detected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">in_freefall </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freefall_start_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;âš ï¸  FREEFALL DETECTED! Acceleration: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">magnitude</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> m/sÂ²&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Check if freefall has lasted long enough</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freefall_start_time </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    freefall_duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_time </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freefall_start_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nanoseconds </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> freefall_duration </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FREEFALL_DURATION</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;âš ï¸  SUSTAINED FREEFALL: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">freefall_duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">s - Possible fall in progress!&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Exit freefall state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">in_freefall</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">in_freefall </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freefall_start_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">check_impact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> magnitude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Check for sudden impact based on high acceleration spikes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        When a robot hits the ground, the IMU experiences a sudden, large</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        acceleration spike significantly above normal gravity.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            magnitude: Current acceleration magnitude in m/sÂ²</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> magnitude </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IMPACT_THRESHOLD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;ðŸš¨ IMPACT DETECTED! Acceleration spike: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">magnitude</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> m/sÂ² - FALL EVENT!&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fall_detected </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Reset freefall tracking after impact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">in_freefall </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">freefall_start_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">imu_callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Imu</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Process IMU data to detect fall events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            msg: The IMU message containing sensor measurements</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Get current timestamp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            current_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_msg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Calculate total acceleration magnitude</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            magnitude </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">calculate_acceleration_magnitude</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Check for freefall condition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">check_freefall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">magnitude</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Check for impact condition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">check_impact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">magnitude</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Log normal readings periodically (every 10th message to reduce spam)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token builtin">hasattr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;message_count&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">message_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">message_count </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">message_count </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Acceleration magnitude: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">magnitude</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> m/sÂ² &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;[Normal range: 8-11 m/sÂ²]&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Store for next iteration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_acceleration_magnitude </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> magnitude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Error in fall detection callback: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Main entry point for the fall detector node.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fall_detector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FallDetector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fall_detector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> KeyboardInterrupt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fall_detector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destroy_node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shutdown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The <code>FallDetector</code> node implements a state machine that tracks the robot through potential fall phases. The <code>calculate_acceleration_magnitude</code> method uses numpy to compute the Euclidean norm of the three-axis acceleration vector - this is the total magnitude of acceleration the robot is experiencing, which should be approximately 9.81 m/sÂ² when stationary (due to gravity).</p>
<p>The freefall detection logic is based on a key insight: when a robot falls freely through the air, it experiences weightlessness, similar to astronauts in orbit. The IMU measures near-zero acceleration because both the robot and the sensor are falling at the same rate. The <code>check_freefall</code> method detects when acceleration drops below 2.0 m/sÂ² and tracks how long this condition persists. Short drops below the threshold might be sensor noise or momentary loss of contact, but sustained freefall exceeding 0.3 seconds strongly indicates a fall in progress.</p>
<p>The impact detection in <code>check_impact</code> watches for the opposite extreme: sudden acceleration spikes above 20.0 m/sÂ² that occur when the robot collides with the ground. These spikes are typically 2-3 times normal gravity, creating an unmistakable signature. In a production system, detecting impact triggers emergency protocols: disabling motor torque to prevent joint damage, activating complaint control to absorb shock, or sending alerts to human supervisors.</p>
<p>This example demonstrates advanced IMU processing concepts: vector magnitude calculation using numpy, time-based state tracking with ROS2 Time objects, threshold-based event detection, and error handling for robustness. The fall detection patterns shown here are used in real humanoid robots to enable safer operation - they&#x27;re the difference between a robot that catastrophically damages itself in a fall and one that gracefully manages the incident.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-practice-exercise-trace-the-balance-control-response">ðŸ¤ Practice Exercise: Trace the Balance Control Response<a href="#-practice-exercise-trace-the-balance-control-response" class="hash-link" aria-label="Direct link to ðŸ¤ Practice Exercise: Trace the Balance Control Response" title="Direct link to ðŸ¤ Practice Exercise: Trace the Balance Control Response" translate="no">â€‹</a></h3>
<p>You&#x27;re designing balance control for a humanoid robot. Given the IMU data stream below, identify when the robot is stable versus at risk of falling. For each sample, determine which balance strategy (ankle/hip/step) would be appropriate.</p>
<p><strong>Sample IMU Data to Analyze</strong>:</p>
<table><thead><tr><th>Time (ms)</th><th>Roll Angle (Â°)</th><th>Pitch Angle (Â°)</th><th>Forward Accel (m/sÂ²)</th><th>Your Answer: Strategy Needed</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td></td></tr><tr><td>50</td><td>0.5</td><td>-2.0</td><td>-0.5</td><td></td></tr><tr><td>100</td><td>1.2</td><td>-4.1</td><td>-1.2</td><td></td></tr><tr><td>150</td><td>4.5</td><td>-7.3</td><td>-2.1</td><td></td></tr><tr><td>200</td><td>8.2</td><td>-12.5</td><td>-3.8</td><td></td></tr></tbody></table>
<p><strong>Guiding Questions</strong>:</p>
<ol>
<li class="">At what point would ankle strategy fail? (Hint: When tilt exceeds 5 degrees)</li>
<li class="">When would hip strategy become necessary? (When tilt exceeds 5 degrees but is less than 15 degrees)</li>
<li class="">When must the robot take a step to avoid falling? (When tilt trend shows continued increase beyond hip strategy limits)</li>
<li class="">Why is the forward acceleration magnitude increasing as the pitch angle increases? (Consider how tilting forward causes the robot to accelerate in that direction due to gravity)</li>
</ol>
<p><strong>Challenge Option</strong> (for advanced students):</p>
<ul>
<li class="">Calculate the angular velocity (rate of change of pitch angle) between each sample</li>
<li class="">Predict: if the current trend continues, will the robot fall? How many milliseconds until pitch exceeds 15 degrees?</li>
<li class="">What additional sensor data would help you make a better prediction?</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">â€‹</a></h2>
<p><strong>Key Takeaways</strong>:</p>
<ul>
<li class="">
<p><strong>IMU Components</strong>: Accelerometers, gyroscopes, and magnetometers work together to measure motion, rotation, and heading. Each has distinct strengths - accelerometers provide a gravity reference for tilt, gyroscopes measure precise rotation, magnetometers offer absolute heading - and weaknesses - accelerometers are noisy, gyroscopes drift over time, magnetometers suffer from magnetic interference.</p>
</li>
<li class="">
<p><strong>Sensor Fusion is Essential</strong>: No single IMU sensor is perfect for long-term orientation estimation. Gyroscope drift accumulates over hours, making long-term estimates useless. Accelerometers are noisy and affected by motion. Combining them through sensor fusion techniques creates reliable estimates, which is why the next lesson covers fusion in depth.</p>
</li>
<li class="">
<p><strong>sensor_msgs/Imu Structure</strong>: ROS2 provides a standard message format containing orientation (as a quaternion to avoid gimbal lock), angular velocity (from gyroscope), linear acceleration (from accelerometer, including gravity), and covariance matrices (indicating measurement confidence). Understanding this structure is essential for integrating IMU data into balance control systems.</p>
</li>
<li class="">
<p><strong>Proprioception Enables Humanoid Control</strong>: The combination of IMU data (body orientation and acceleration) plus joint encoders (limb positions) creates the robot&#x27;s internal sense of body position and motion. This proprioceptive feedback is as critical for humanoid balance as human proprioception is for activities like walking on a narrow beam or catching yourself when you trip.</p>
</li>
<li class="">
<p><strong>Balance is an Active Control Loop</strong>: The balance system continuously cycles through sensing tilt (IMU) â†’ computing correction (controller) â†’ executing action (motor commands) â†’ sensing again. With IMU sampling at 200+ Hz and total reaction times of 25-50 milliseconds, robots can prevent falls faster than humans can react.</p>
</li>
</ul>
<p>You should now be able to explain what an IMU measures, describe the trade-offs between its three component sensors, interpret <code>sensor_msgs/Imu</code> messages in ROS2 code, and understand how IMU feedback enables humanoid robots to maintain balance and develop body awareness. You&#x27;re ready to learn how combining IMU data with other sensors creates even more robust perception systems.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">â€‹</a></h2>
<p>You now understand how humanoid robots sense their own motion and orientation through inertial measurement, and how this proprioceptive feedback enables dynamic balance control in real time.</p>
<p>In <a class="" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/04-sensor-fusion">Lesson 4: Sensor Fusion Techniques</a>, we&#x27;ll explore how to combine IMU data with cameras, depth sensors, and other perception sources to create robust, reliable perception systems. You&#x27;ve seen that individual sensors have critical limitations: IMUs drift over time as gyroscope errors accumulate, cameras fail in darkness or poor lighting, depth sensors struggle with reflective or transparent surfaces. Sensor fusion is the set of techniques that allow robots to overcome these individual weaknesses by intelligently combining multiple information sources.</p>
<p>A humanoid robot that relies solely on its IMU for balance will eventually fall as gyroscope drift accumulates and orientation estimates become meaningless. By fusing IMU data with visual odometry (tracking motion through camera frames), robots can correct drift and maintain accurate self-awareness over extended operation periods. This is the bridge from understanding individual sensors to building complete, production-ready robot perception systems that operate reliably in the real world.</p>
<p>This progression - from cameras to depth sensing to proprioception to sensor fusion - shows how robots build increasingly sophisticated understanding of both their world and themselves, layer by layer.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/hackathon-phase-01/docs/tags/ros-2">ros2</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/hackathon-phase-01/docs/tags/sensors">sensors</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/hackathon-phase-01/docs/tags/humanoid-robotics">humanoid-robotics</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/hackathon-phase-01/docs/tags/perception">perception</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/13-Physical-AI-Humanoid-Robotics/02-sensors-perception/03-imu-proprioception.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/depth-sensing.summary"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Summary: Lesson 2 - Depth Sensing Technologies</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/sensors-perception/imu-proprioception.summary"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Summary: Lesson 3 - IMU and Proprioception</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-an-imu" class="table-of-contents__link toc-highlight">What Is an IMU?</a></li><li><a href="#why-imu-matters-for-physical-ai" class="table-of-contents__link toc-highlight">Why IMU Matters for Physical AI</a></li><li><a href="#key-principles" class="table-of-contents__link toc-highlight">Key Principles</a><ul><li><a href="#principle-1-imu-sensor-components-and-what-they-measure" class="table-of-contents__link toc-highlight">Principle 1: IMU Sensor Components and What They Measure</a></li><li><a href="#principle-2-sensor-drift-and-noise-characteristics" class="table-of-contents__link toc-highlight">Principle 2: Sensor Drift and Noise Characteristics</a></li><li><a href="#principle-3-sensor_msgsimu-message-structure-and-ros2-integration" class="table-of-contents__link toc-highlight">Principle 3: sensor_msgs/Imu Message Structure and ROS2 Integration</a></li><li><a href="#principle-4-proprioception---robots-sense-of-body-position-and-motion" class="table-of-contents__link toc-highlight">Principle 4: Proprioception - Robot&#39;s Sense of Body Position and Motion</a></li><li><a href="#principle-5-balance-control-loop---feedback-and-correction" class="table-of-contents__link toc-highlight">Principle 5: Balance Control Loop - Feedback and Correction</a></li><li><a href="#-ai-colearning-prompt" class="table-of-contents__link toc-highlight">ðŸ’¬ AI Colearning Prompt</a></li><li><a href="#-expert-insight-imu-initialization-calibration-and-why-your-robot-falls-over" class="table-of-contents__link toc-highlight">ðŸŽ“ Expert Insight: IMU Initialization, Calibration, and Why Your Robot Falls Over</a></li></ul></li><li><a href="#real-world-examples" class="table-of-contents__link toc-highlight">Real-World Examples</a><ul><li><a href="#-boston-dynamics-atlas" class="table-of-contents__link toc-highlight">ðŸ“Š Boston Dynamics Atlas</a></li><li><a href="#-agility-robotics-digit" class="table-of-contents__link toc-highlight">ðŸ“Š Agility Robotics Digit</a></li><li><a href="#-unitree-h1" class="table-of-contents__link toc-highlight">ðŸ“Š Unitree H1</a></li></ul></li><li><a href="#practical-example-balance-state-monitoring" class="table-of-contents__link toc-highlight">Practical Example: Balance State Monitoring</a></li><li><a href="#practical-example-fall-detection-algorithm" class="table-of-contents__link toc-highlight">Practical Example: Fall Detection Algorithm</a><ul><li><a href="#-practice-exercise-trace-the-balance-control-response" class="table-of-contents__link toc-highlight">ðŸ¤ Practice Exercise: Trace the Balance Control Response</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/">Textbook</a></li><li class="footer__item"><a class="footer__link-item" href="/hackathon-phase-01/docs/Physical-AI-Humanoid-Robotics/ros2-nervous-system/">Module 1: ROS2</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/anusbutt/hackathon-phase-01" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://linkedin.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">X (Twitter)<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://instagram.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://panaversity.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Panaversity<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 Physical AI & Humanoid Robotics Textbook. Built for Panaversity Hackathon.</div></div></div></footer><button class="floatingChatButton__Uyc" aria-label="Open AI Assistant" title="Ask questions about Physical AI &amp; Humanoid Robotics"><span class="chatIcon_GGtK">ðŸ’¬</span><span class="chatLabel_InO3">AI Assistant</span></button></div>
</body>
</html>